

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Virtual servers &mdash; openbiomaps 4.2 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.min.css" type="text/css" />
    <link rel="search" title="Search" href="search.html" /> 

</head>

<body>
    <table style='background-color:#eeeeee;padding:10px;margin:0;width:100%'>
    <tr>
        <td rowspan='2' style='vertical-align:bottom'>
            <a href='https://openbiomaps.org' style='border:0'><img src="_images/OpenBioMaps_small.png"></a>
        </td>
        <td style='vertical-align:top;text-align:right'>
            <a href='https://openbiomaps.org' target='_blank'>Home</a> | 
            <a href='https://openbiomaps.org/community/' target='_blank'>Community</a> | 
            <a href='faq.html'>FAQ</a> | 
            <a href='https://gitlab.com/groups/openbiomaps/-/issues'>Issues</a> | 
            <a href='https://twitter.com/OpenBioMaps' target='_blank'>Twitter</a> | 
            <a href="https://github.com/OpenBioMaps/documentation/tree/master/official_docs" class="fa fa-github">Edit documents</a>
        </td>
    </tr>
    <tr>
         <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
          <a href="https://openbiomaps.org/documents/en/"><img src="_static/flagicons/en.png" alt="en" title="in English" border="0" /></a>
          <a href="https://openbiomaps.org/documents/hu/"><img src="_static/flagicons/hu.png" alt="hu" title="Magyarul" border="0" /></a>
         </td>
    </tr>
    </table>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="index.html">Docs</a></li>
        
      <li>Virtual servers</li>
    
    
      <li class="breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="introduction.html#openbiomaps-overview">OpenBioMaps overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="user_interface.html">User interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="profile.html">Profile page</a></li>
<li class="toctree-l2"><a class="reference internal" href="invitations.html">Invitations</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html">Administrative pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="upload_forms.html">Upload form management</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_query_interface.html">Spatial queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_query_interface.html#text-queries">Text queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_query_interface.html#save-query">save query</a></li>
<li class="toctree-l2"><a class="reference internal" href="data_query_interface.html#share-query">share query</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_interface.html#log-in">Log in</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_interface.html#loged-in-surface">Loged-in surface</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_interface.html#map-page-interface">Map page interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="user_interface.html#upload-data-interface">Upload data interface</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="profile.html">Profile page</a><ul>
<li class="toctree-l2"><a class="reference internal" href="profile.html#user-data">User data</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#settings">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#orcid-profile">ORCID profile</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#user-information">User information</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#other-databases">Other databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#activity">Activity</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#interrupted-imports">Interrupted imports</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#stored-queries">Stored queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#saved-results">Saved results</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#api-keys">Api keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#manage-custom-geometries">Manage custom geometries</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#create-postgresql-user">Create PostgreSQL user</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#manage-downloads">Manage downloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="profile.html#opinions">Opinions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="upload_data.html">Upload data workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="upload_data.html#the-following-options-are-available-for-data-uploading">The following options are available for data uploading</a></li>
<li class="toctree-l2"><a class="reference internal" href="upload_data.html#data-export-from-the-upload-forms">Data export from the upload forms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="data_access.html">Data access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="data_access.html#data-access-features">Data access features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#api-handlers">API handlers:</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#oauth">OAUTH</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pds">PDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#web-api">WEB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#form-data-get-form-data-results-explanations">Form Data (get_form_data results) explanations</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#training-explanations-and-examples">Training explanations and examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#examples">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#general-api-answers">General API answers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="admin_pages.html">Administrative pages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#administrative-access">Administrative access</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#database-columns">Database columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#groups">Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#upload-forms">Upload forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#functions">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#species-names">Species names</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#access">Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#translations">Translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#interrupted-uploads">Interrupted uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#file-manager">File manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#sql-query-settings">SQL query settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#web-map-layers">Web Map Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#members">Members</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#mapserver-settings">Mapserver settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_pages.html#server-logs">Server logs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="modules.html#modul-administration">Modul administration:</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html#module-descriptions">Module descriptions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="server_install.html">Install new OBM Server guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="server_install.html#common-errors-and-solutions-after-new-installations-or-updates">Common errors and solutions after new installations or updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_install.html#server-configuratin">Server configuratin</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_install.html#local-variables-for-a-project">Local variables for a project</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pwa.html">PWA application</a><ul>
<li class="toctree-l2"><a class="reference internal" href="pwa.html#what-is-the-obm-pwa-application">What is the OBM PWA application?</a></li>
<li class="toctree-l2"><a class="reference internal" href="pwa.html#configuration-settings-for-pwa-application">Configuration settings for PWA application</a></li>
<li class="toctree-l2"><a class="reference internal" href="pwa.html#installation">Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-openbiomaps">What is OpenBioMaps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-openbiomaps-consortium">What is OpenBioMaps consortium?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-contact-the-consortium">How can I contact the consortium?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-create-a-new-database">How can I create a new database?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-upload-data">How can I upload data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-store-queries-and-how-can-i-refere-them">How can I store queries and how can I refere them?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-sign-up-for-openbiomaps">How can I sign up for OpenBioMaps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#is-there-a-programmable-interface-for-developers">Is there a programmable interface for developers?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-languages-are-supported">What languages are supported?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#which-operating-systems-are-compatible-with-openbiomaps">Which operating systems are compatible with OpenBioMaps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-contribute-to-openbiomaps">How can I contribute to OpenBioMaps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#shoud-i-pay-for-anything">Shoud I pay for anything?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-and-where-the-openbiomaps-stores-the-data">How and where the OpenBioMaps stores the data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-join-openbiomaps">How can I join OpenBioMaps?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#i-lost-my-password-how-can-i-get-a-new">I lost my password, how can I get a new?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#pink-squares-appear-on-the-map-page">Pink squares appear on the map page</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-can-i-control-the-shared-polygons">How can I control the shared polygons?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#what-is-the-rum">What is the RUM?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#are-there-doi-for-databases">Are there DOI for databases?</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html#how-to-set-up-archiving">How to set up archiving?</a></li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="virtual-servers">
<h1>Virtual servers<a class="headerlink" href="#virtual-servers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>It is the currently supported up-to-date virtual environment release of OpenBioMaps.</p>
<p>It is good for testing, developing or it can be applied in production environment after some updates.</p>
<p>For using docker 4 steps needed:</p>
<ol class="arabic simple">
<li><p>Install docker compose</p></li>
<li><p>Get obm-docker image</p></li>
<li><p>Configure your docker according to host’s speciality (e.g. ssl, smtp)</p></li>
<li><p>Start your docker environment</p></li>
</ol>
<div class="section" id="prepare-install-docker-compose">
<h3>Prepare/Install Docker &amp; Compose<a class="headerlink" href="#prepare-install-docker-compose" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose</span>

<span class="go">sudo chmod +x /usr/local/bin/docker-compose</span>

<span class="go">docker-compose --version</span>
</pre></div>
</div>
<p>docker-compose version 1.29.2, build f46880fe</p>
<p>Visit this page for further inforamtion about installing docker:</p>
<p><a class="reference external" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
</div>
<div class="section" id="install-setup-openbiomaps-an-instance">
<h3>Install / Setup OpenBioMaps an instance<a class="headerlink" href="#install-setup-openbiomaps-an-instance" title="Permalink to this headline">¶</a></h3>
<p>It is recommended to put docker files into /srv/docker directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">openbiomaps</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">openbiomaps</span>

<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openbiomaps</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">obm</span><span class="o">-</span><span class="n">composer</span><span class="o">.</span><span class="n">git</span> <span class="o">.</span>

<span class="n">sudo</span> <span class="n">su</span>

<span class="n">groupadd</span> <span class="o">-</span><span class="n">g</span> <span class="mi">996</span> <span class="n">docker</span>

<span class="n">adduser</span> <span class="n">foo</span> <span class="n">docker</span>

<span class="n">docker</span> <span class="n">network</span> <span class="n">create</span> <span class="n">obm_web</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">pull</span>

<span class="o">./</span><span class="n">obm_pre_install</span><span class="o">.</span><span class="n">sh</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>

<span class="o">./</span><span class="n">obm_post_install</span><span class="o">.</span><span class="n">sh</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">restart</span>
</pre></div>
</div>
</div>
<div class="section" id="visit-your-obm-app">
<h3>Visit your OBM app<a class="headerlink" href="#visit-your-obm-app" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://YOUR_SERVER_NAME:9880/">http://YOUR_SERVER_NAME:9880/</a></p>
<p><a class="reference external" href="http://YOUR_SERVER_NAME:9880/projects/sablon/">http://YOUR_SERVER_NAME:9880/projects/sablon/</a></p>
<p>Log in your template databse using <em>valaki&#64;openbiomaps.org</em> user name and <em>abc123</em> password;</p>
<p>If you installed the docker in your local computer you can access the services above in localhost.</p>
</div>
<div class="section" id="database-access">
<h3>Database access<a class="headerlink" href="#database-access" title="Permalink to this headline">¶</a></h3>
<p>You can access your postgres database on the following preconfigured online database manager applications. However, it depends on your host-docker relationship.</p>
<p><a class="reference external" href="http://YOUR_SERVER_NAME:9881/">phppgadmin</a></p>
<p><a class="reference external" href="http://YOUR_SERVER_NAME:9882/">adminer</a></p>
<p>with <em>sablon_admin</em> username and <em>12345</em> password. You can manage your database with <em>biomapsadmin</em> user and <em>abcd1234</em> password.</p>
<p>If you change these passwords, should be updated the following places:</p>
<p>/etc/openbiomaps/system_vars.php.inc</p>
<p>/var/www/html/biomaps/projects/sablon/local_vars.php.inc</p>
<p>/var/www/html/biomaps/projects/sablon/private/private.map</p>
<p>In the mapfile, the new encrypted password can be generated with the ms-access-key located in /var/lib/openbiomaps/maps/access.key</p>
<p>The two databases ‘biomaps’ and ‘gisdata’ have root postgres users respectively <em>biomaps</em> and <em>gisdata</em> (instead of the ususal <em>postgres</em>) and both password is <em>changeMe</em>.</p>
</div>
<div class="section" id="docker-maintenance">
<h3>Docker maintenance<a class="headerlink" href="#docker-maintenance" title="Permalink to this headline">¶</a></h3>
<p>This step is not obligatory, but can be useful if you need a strong web admin interface for docker management.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">portainer</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="o">/</span><span class="n">srv</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">portainer</span>

<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">gitlab</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">openbiomaps</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">obm</span><span class="o">-</span><span class="n">portainer</span><span class="o">.</span><span class="n">git</span> <span class="o">.</span>

<span class="n">sudo</span> <span class="n">su</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">pull</span>

<span class="c1"># Genereate a strong random password for the admin user</span>
<span class="n">bash</span> <span class="o">./</span><span class="n">password_gen</span><span class="o">.</span><span class="n">sh</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="n">up</span> <span class="o">-</span><span class="n">d</span>

<span class="n">On</span> <span class="n">the</span> <span class="n">portainer</span> <span class="n">interface</span> <span class="n">use</span> <span class="n">the</span> <span class="s2">&quot;Get started&quot;</span> <span class="n">button</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="visit-your-docker-admin-portainer-app">
<h3>Visit your docker-admin (portainer) app<a class="headerlink" href="#visit-your-docker-admin-portainer-app" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://YOUR_SERVER_NAME:9000/">http://YOUR_SERVER_NAME:9000/</a></p>
<p>Log in your app using <em>admin</em> user name and your password;</p>
<p>If you installed the docker in your local computer you can access the services above in localhost.</p>
</div>
<div class="section" id="obm-maintenance">
<h3>OBM maintenance<a class="headerlink" href="#obm-maintenance" title="Permalink to this headline">¶</a></h3>
<p>You can access OBM server admin interface:
<a class="reference external" href="http://localhost:9880/supervisor.php">http://localhost:9880/supervisor.php</a></p>
<p>with <em>supervisor</em> username and password created by obm_post_install.sh. This password is located at /etc/openbiomaps/.htpasswd.</p>
</div>
<div class="section" id="updates-update-application-with-docker">
<h3>Updates: update application with Docker<a class="headerlink" href="#updates-update-application-with-docker" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose pull
<span class="go">Pulling biomaps_db ... done</span>
<span class="go">Pulling mapserver  ... done</span>
<span class="go">Pulling app        ... done</span>
<span class="go">Pulling phppgadmin ... done</span>
<span class="go">Pulling adminer    ... done</span>

<span class="gp">foo@bar:~$</span> docker-compose up -d
<span class="go">Creating obm-composer_biomaps_db_1 ... done</span>
<span class="go">Creating obm-composer_mapserver_1  ... done</span>
<span class="go">Creating obm-composer_adminer_1    ... done</span>
<span class="go">Creating obm-composer_phppgadmin_1 ... done</span>
<span class="go">Creating obm-composer_app_1        ... done</span>
</pre></div>
</div>
<p>Update only one container</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose up -d app
</pre></div>
</div>
</div>
<div class="section" id="after-founding-a-new-project">
<h3>After founding a new project<a class="headerlink" href="#after-founding-a-new-project" title="Permalink to this headline">¶</a></h3>
<p>You <strong>must set up a Mail server access</strong> to send mails from the app</p>
<p>Assuming that the new servers do not have their own domain name, the default value for sending mail is set to smtp (/etc/openbiomaps/system_vars.php.inc), which requires you to configure outgoing smtp servers and associated authentication for each projects (/var/www/html/biomaps/projects/…/local_vars.php.inc)</p>
<p>These config files can be edited in the supervisor interface.</p>
<p>Find the mail settings section and set up the smtp host and authentication if needed.</p>
<p>If there is an external smtp server here you are an example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">// Mail settings</span>
<span class="go">define(&#39;SMTP_AUTH&#39;,true); # true</span>
<span class="go">define(&#39;SMTP_HOST&#39;,&#39;mail.my-mail-server.com&#39;);</span>
<span class="go">define(&#39;SMTP_USERNAME&#39;,&#39;my-name@my-mail-server.com&#39;);</span>
<span class="go">define(&#39;SMTP_PASSWORD&#39;,&#39;something&#39;);</span>
<span class="go">define(&#39;SMTP_SECURE&#39;,&#39;tls&#39;); # Or starttls</span>
<span class="go">define(&#39;SMTP_PORT&#39;,&#39;587&#39;); # 465</span>
<span class="go">define(&#39;SMTP_SENDER&#39;,&#39;openbiomaps@my-mail-server.com&#39;);</span>
</pre></div>
</div>
<p>If SMTP_SENDER is not set, the SMTP_USERNAME will be the sender. Sending mails with google, with these simple settings is not possible, because google uses xoauth layer to authenticate! It is possible to include that layer here!</p>
<p>If the host system will be the smtp server:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go"> // Mail settings</span>
<span class="go">define(&#39;SMTP_AUTH&#39;,false);</span>
<span class="go">define(&#39;SMTP_HOST&#39;,&#39;172.17.0.1&#39;);</span>
<span class="go">define(&#39;SMTP_PORT&#39;,&#39;25&#39;);</span>
<span class="go">define(&#39;SMTP_SENDER&#39;,&#39;info@you-smtp-server&#39;);</span>
</pre></div>
</div>
<p>For the ip address above check host “ip addr | grep docker0”</p>
<p>On the host depending on what MTA you have here you some examples:</p>
<p><strong>Exim4</strong></p>
<p>In the /etc/exim4/update-exim4.conf file</p>
<blockquote>
<div><p>dc_relay_nets=‘172.21.0.0/16’
dc_local_interfaces=‘127.0.0.1 ; ::1 ; 172.17.0.1’</p>
</div></blockquote>
<p>these lines shoud be updated, but depending on your exim config maybe something else as well.</p>
<p>In the /etc/exim4/exim4.config file</p>
<dl>
<dt>“hostlist   relay_from_hosts…” line, you should extend with the obm_back network e.g.</dt><dd><p>hostlist   relay_from_hosts = localhost :172.20.0.0/16 :172.17.0.0/16 :172.21.0.0/16</p>
<p>Comment: “Maybe one of the three network is enough above, I did not tested yet”</p>
</dd>
</dl>
<p><strong>Postfix</strong></p>
<p>inet_interfaces = 172.17.0.1</p>
<p>mynetworks = 172.21.0.4 172.20.0.6</p>
<p>Here’s how to find out docker networks and ip addresses:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker container ls</span>
</pre></div>
</div>
<p>search for obm-composer_app_1</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker inspect xxxxx_obm-composer_app_1</span>
</pre></div>
</div>
<p>Search for obm_back and obm_web interfaces:
obm-composer_obm_back {</p>
<blockquote>
<div><p>…
“IPAddress”: “172.20.0.6”,</p>
</div></blockquote>
<p>}
obm-composer_obm_web {</p>
<blockquote>
<div><p>…
“IPAddress”: “172.21.0.4”,</p>
</div></blockquote>
<p>}</p>
<p><strong>Firewall</strong></p>
<p>You may also need to update your firewall to enable incoming mails from image to host. The network address of obm_back must be allowed as incoming network for the firewall. E.g.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ufw allow from 172.20.0.0/16 proto tcp to any port 25</span>
</pre></div>
</div>
<p><strong>Global smtp settings</strong></p>
<p>Most probably you want to use the same smtp settings for your all project in your server. In this case use the</p>
<ul>
<li><p>SMTP_GLOBAL_HOST</p></li>
<li><p>SMTP_GLOBAL_AUTH</p></li>
<li><p>SMTP_GLOBAL_USERNAME</p></li>
<li><p>SMTP_GLOBAL_PASSWORD</p></li>
<li><p>SMTP_GLOBAL_SECURE</p></li>
<li><p>SMTP_GLOBAL_PORT</p></li>
<li><p>SMTP_GLOBAL_SENDER</p>
<p>parameters in the sytem_vars.php.inc. At least the SMTP_GLOBAL_HOST should be set if you want use global params. The local params override the globals allways.</p>
</li>
</ul>
</div>
<div class="section" id="setting-up-ssl-https-access-highly-recommended">
<h3>Setting up <strong>ssl</strong>/<strong>https access</strong> (highly recommended)<a class="headerlink" href="#setting-up-ssl-https-access-highly-recommended" title="Permalink to this headline">¶</a></h3>
<p>You may need to update your project access protocol setting in the Supervisor however it is depending on your host’s setting.</p>
<p><em>There is no webserver on the Host, but Host provide ssl certs for docker</em></p>
<p>One possible way is to use the host’s ssl certificates by the way to mount the necessery directories from the host to the docker.
You can create letsencrypt</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">apt install dehydrated</span>
<span class="go">vi /etc/dehydrated/domain.txt</span>
<span class="go">    YOURDOMAIN</span>
<span class="go">dehydrated -c</span>
</pre></div>
</div>
<p>docker-compose.yml:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">services:</span>
<span class="go">  app:</span>
<span class="go">    image: registry.gitlab.com/openbiomaps/web-app:latest</span>
<span class="go">    volumes:</span>
<span class="go">      ...</span>
<span class="go">      - /etc/letsencrypt/YOURDOMAIN:/etc/apache2/certs</span>
<span class="go">      - ./apache2/default-ssl.conf:/etc/apache2/sites-enabled/default-ssl.conf</span>
<span class="go">    ports:</span>
<span class="go">     - 80:80</span>
<span class="go">     - 443:443</span>
<span class="go">    ...</span>
</pre></div>
</div>
<p><em>Host has a web server and provide a proxy for the docker</em></p>
<p>An other way to use host’s apache proxy</p>
<p>Host: /etc/apache2/sites-enabled/000-default.conf</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RedirectMatch permanent ^(?!/.well-known/.*) https://YOURDOMAIN/
</pre></div>
</div>
<p>Host: /etc/apache2/sites-enabled/default-ssl.conf</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RequestHeader set X-Forwarded-Proto &#39;https&#39;
RequestHeader set X-Forwarded-Host &#39;YOURDOMAIN&#39;
RequestHeader set X-Forwarded-Port &quot;443&quot;

ProxyPass /.well-known !
ProxyPass /
http://localhost:8090/

ProxyPassReverse /
http://localhost:8090/

ProxyPreserveHost On
&lt;Proxy *&gt;
allow from all
&lt;/Proxy&gt;
</pre></div>
</div>
<p>docker-compose.yml:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">services:</span>
<span class="go">  app:</span>
<span class="go">  ...</span>
<span class="go">      ports:</span>
<span class="go">      - 80:8090</span>
<span class="go">  ...</span>
</pre></div>
</div>
<p>In this case you don’t need to use https protocol in projects settings because the obm can recognize the https request through the HTTP-X-FORWARD settings.</p>
<p><em>Using traefik to process different domain request in the docker level. E.g. you have several docker containers on your host…</em></p>
<p>To set up docker based https trafic rooter we recommend to use traefik2.x in an other container:</p>
<p><a class="reference external" href="https://gitlab.com/openbiomaps/docker/traefik2.0-proxy">https://gitlab.com/openbiomaps/docker/traefik2.0-proxy</a></p>
<p>And update your docker-compose.yml file to communicate with traefik:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">networks:</span>
<span class="go">   traefik20_default:</span>
<span class="go">    external: true</span>
<span class="gp">  #</span>obm_web:
<span class="gp">  #</span>  external: <span class="nb">true</span>

<span class="go">services:</span>
<span class="go">  app:</span>
<span class="go">  ....</span>
<span class="gp">#</span> Do not use ports, traefik provides them!!!
<span class="gp">#</span>    ports:
<span class="gp">#</span>      - <span class="m">80</span>:80
<span class="gp">#</span>      - <span class="m">443</span>:443
<span class="go">    networks:</span>
<span class="go">      - obm_back</span>
<span class="gp">      #</span>- obm_web
<span class="go">      - traefik20_default</span>
<span class="go">    labels:</span>
<span class="go">      - traefik.enable=true</span>
<span class="go">      - traefik.docker.network=traefik20_default</span>
<span class="go">      - traefik.http.routers.obm-secured.rule=Host(`YOUR_DOMAIN`)</span>
<span class="go">      - traefik.http.routers.obm-secured.entrypoints=https</span>
<span class="go">      - traefik.http.routers.obm-secured.middlewares=hsts@file</span>
<span class="go">      - traefik.http.routers.obm-secured.tls.certresolver=letsencrypt</span>
<span class="go">      - &quot;traefik.http.middlewares.obm-biotika-redirect.redirectregex.regex=^https?://biotika.YOURDOMAIN(.*)&quot;</span>
<span class="go">      - &quot;traefik.http.middlewares.obm-biotika-redirect.redirectregex.replacement=https://YOUR_DOMAIN/projects/YOURPROJECT/&quot;</span>
<span class="go">      - traefik.http.middlewares.obm-biotika-redirect.redirectregex.permanent=true</span>

<span class="go">  phppgadmin:</span>
<span class="go">  ...</span>
<span class="go">    networks:</span>
<span class="gp">        #</span>- obm_web
<span class="go">      - obm_back</span>
<span class="go">      - traefik20_default</span>
<span class="go">    labels:</span>
<span class="go">      - &quot;traefik.enable=true&quot;</span>
<span class="go">      - &quot;traefik.docker.network=traefik20_default&quot;</span>
<span class="go">      - &quot;traefik.http.routers.obm-pgadmin.rule=Host(`phppgadmin.YOURDOMAIN`)&quot;</span>
<span class="go">      - &quot;traefik.http.routers.obm-pgadmin.entrypoints=https&quot;</span>
<span class="go">      - &quot;traefik.http.routers.obm-pgadmin.tls.certresolver=letsencrypt&quot;</span>
<span class="go">      - &quot;traefik.http.services.obm-pgadmin.loadbalancer.server.port=8080&quot;</span>
<span class="go">volumes:</span>
<span class="go">  ...</span>
<span class="go">    traefik20_letsencrypt:</span>
<span class="go">    external: true</span>
</pre></div>
</div>
<p>This latter examples maybe not complete yet…</p>
<p>If you provide Postgres access you also need to set up ssl over postgres</p>
<p>If you have traefik you can configure ssl access there. In other case, you can give ssl certs for your database container and set up postgres to accept connection only through ssl.</p>
<p>docker-compose.yml:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">services:</span>
<span class="go">...</span>
<span class="go">  biomaps_db:</span>
<span class="go">     volumes:</span>
<span class="go">       - /PATH_TO_CERTS/ssl.cert:/etc/ssl/certs/YOURDOMAIN.cert</span>
<span class="go">       - /PATH_TO_CERTS/ssl.key:/etc/ssl/certs/YOURDOMAIN.key</span>
<span class="go">       - ./postgresql.conf:/var/lib/postgresql/data/postgresql.conf</span>
<span class="go">       - ./pg_hba.conf:/var/lib/postgresql/data/pg_hba.conf</span>
</pre></div>
</div>
<p>In biomaps_db container:
/…./pg_hba.conf:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">hostssl all all all md5</span>
</pre></div>
</div>
<p>/…./postgres.conf:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ssl = on</span>
<span class="go">ssl_cert_file = &#39;/etc/ssl/certs/YOURDOMAIN.cert&#39;</span>
<span class="go">ssl_key_file = &#39;/etc/ssl/certs/YOURDOMAIN.key&#39;</span>
</pre></div>
</div>
<p>You can try your postgres connection without ssl:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">psql &quot;postgresql://gisadmin@YOURDMAIN:5432/gisdata?sslmode=disable&quot;</span>
</pre></div>
</div>
<p>If your ssl require works, you will get an error message like this:</p>
<p>psql: FATAL:  no pg_hba.conf entry for host “xxxxxxx”, user “gisadmin”, database “gisdata”, SSL off</p>
</div>
<div class="section" id="id1">
<h3>Docker maintenance<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="stopping-docker">
<h3>Stopping docker<a class="headerlink" href="#stopping-docker" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose down
</pre></div>
</div>
</div>
<div class="section" id="drop-everything-including-data-and-databases">
<h3>Drop everything (including data and databases)<a class="headerlink" href="#drop-everything-including-data-and-databases" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose down -v
</pre></div>
</div>
</div>
<div class="section" id="shell-access-of-the-system-in-the-the-container-image">
<h3>Shell access of the system in the the container image<a class="headerlink" href="#shell-access-of-the-system-in-the-the-container-image" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose <span class="nb">exec</span> app bash
</pre></div>
</div>
<p>Here we accessed the <strong>app</strong> service. See service names in docker-compose.yml file.</p>
</div>
<div class="section" id="reading-logs">
<h3>Reading logs<a class="headerlink" href="#reading-logs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose logs -f app
</pre></div>
</div>
</div>
<div class="section" id="using-pgtop">
<h3>Using pgtop<a class="headerlink" href="#using-pgtop" title="Permalink to this headline">¶</a></h3>
<p>docker-compose exec -u postgres <span class="raw-html-m2r"><service_name></span> pg_top</p>
</div>
<div class="section" id="restart-app">
<h3>Restart app<a class="headerlink" href="#restart-app" title="Permalink to this headline">¶</a></h3>
<p>Do not restart apache from docker shell, but from outside</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose restart app
</pre></div>
</div>
</div>
<div class="section" id="remove-huge-amount-of-old-not-used-docker-images">
<h3>Remove huge amount of old, not used docker images<a class="headerlink" href="#remove-huge-amount-of-old-not-used-docker-images" title="Permalink to this headline">¶</a></h3>
<p>Do we have a lot?</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker images | grep &quot;&lt;none&gt;&quot;</span>
</pre></div>
</div>
<p>Let drop them….</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker images | grep &quot;&lt;none&gt;&quot; | awk &#39;{print $3}&#39; | sed -e &#39;s/^/docker rmi /&#39; | bash</span>
</pre></div>
</div>
<p>You may need to edit the traefik2.0/traefik.yml, traefik2.0/docker-compose.yml and traefik2.0/acme.json files</p>
</div>
<div class="section" id="auto-update-of-docker">
<h3>Auto update of docker<a class="headerlink" href="#auto-update-of-docker" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/OpenBioMaps/scripts/blob/master/docker-auto-update.readme">https://github.com/OpenBioMaps/scripts/blob/master/docker-auto-update.readme</a></p>
</div>
<div class="section" id="archive-tables-data">
<h3>Archive tables, data, …<a class="headerlink" href="#archive-tables-data" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/OpenBioMaps/scripts">https://github.com/OpenBioMaps/scripts</a></p>
</div>
<div class="section" id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://gitlab.com/openbiomaps/web-app">https://gitlab.com/openbiomaps/web-app</a></p></li>
<li><p><a class="reference external" href="https://gitlab.com/openbiomaps/docker/obm-composer">https://gitlab.com/openbiomaps/docker/obm-composer</a></p></li>
</ul>
</div>
</div>
<div class="section" id="not-docker-virtualbox">
<h2>Not docker: VirtualBox<a class="headerlink" href="#not-docker-virtualbox" title="Permalink to this headline">¶</a></h2>
<p>The VirtualBox edition currently is outdated, not recommended to use it!</p>
<ol class="arabic simple">
<li><p>Download virtualbox from <a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p></li>
<li><p>Download the latest .ova image from <a class="reference external" href="http://openbiomaps.org/downloads/virtual-image/">http://openbiomaps.org/downloads</a></p></li>
<li><p>Read this readme for the the next steps: <a class="reference external" href="http://openbiomaps.org/downloads/virtual-image/README">http://openbiomaps.org/downloads/virtual-image/README</a></p></li>
</ol>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'4.2',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright OpenBioMaps Consortium 2015 - 2020.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.0+.
        </div>
    </div>  

</body>
</html>