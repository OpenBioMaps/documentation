
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Virtual servers &#8212; openbiomaps 3.2 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <table style='background-color:#eeeeee;padding:10px;margin:0;width:100%'>
    <tr>
        <td rowspan='2' style='vertical-align:bottom'>
            <a href='http://openbiomaps.org' style='border:0'><img src="_images/OpenBioMaps.png"></a>
        </td>
        <td style='vertical-align:top;text-align:right'>
            <a href='http://openbiomaps.org' target='_blank'>Home</a> | 
            <a href='http://openbiomaps.org/community/' target='_blank'>Community</a> | 
            <a href='faq.html'>FAQ</a> | 
            <a href='https://gitlab.com/groups/openbiomaps/-/issues'>Issues</a> | 
            <a href='https://twitter.com/OpenBioMaps' target='_blank'>Twitter</a> | 
            <a href="https://github.com/OpenBioMaps/documentation/tree/master/official_docs" class="fa fa-github">Edit documents</a>
        </td>
    </tr>
    <tr>
         <td style="padding: 0px 10px 0px 0px; text-align: right; vertical-align: bottom;">
          <a href="http://openbiomaps.org/documents/en/"><img src="_static/flagicons/en.png" alt="en" title="in English" border="0" /></a>
          <a href="http://openbiomaps.org/documents/hu/"><img src="_static/flagicons/hu.png" alt="hu" title="Magyarul" border="0" /></a>
         </td>
    </tr>
    </table>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">openbiomaps 3.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="virtual-servers">
<h1>Virtual servers<a class="headerlink" href="#virtual-servers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h2>
<p>It is the currently supported up-to-date virtual environment release of OpenBioMaps.</p>
<p>It is good for testing, developing or it can be applied in production environment after some updates.</p>
<p>Using docker is easy! Only 3 steps needed:</p>
<ol class="arabic simple">
<li>Install docker compose</li>
<li>Get obm-docker image</li>
<li>start your docker environment</li>
</ol>
<div class="section" id="prepare-install-docker-compose">
<h3>Prepare/Install Docker &amp; Compose<a class="headerlink" href="#prepare-install-docker-compose" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> sudo curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-<span class="sb">`</span>uname -s<span class="sb">`</span>-<span class="sb">`</span>uname -m<span class="sb">`</span> -o /usr/local/bin/docker-compose

<span class="gp">foo@bar:~$</span> sudo chmod +x /usr/local/bin/docker-compose

<span class="gp">foo@bar:~$</span> docker-compose --version

<span class="go">docker-compose version 1.22.0, build f46880fe</span>
</pre></div>
</div>
<p>Visit this page for further inforamtion about installing docker
<a class="reference external" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
</div>
<div class="section" id="obm-docker-install">
<h3>OBM docker install<a class="headerlink" href="#obm-docker-install" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> git clone https://gitlab.com/openbiomaps/docker/obm-composer.git

<span class="gp">foo@bar:~$</span> <span class="nb">cd</span> obm-composer/

<span class="gp">foo@bar:~$</span> sudo groupadd -g <span class="m">996</span> docker

<span class="gp">foo@bar:~$</span> sudo adduser foo docker

<span class="gp">foo@bar:~$</span> docker network create obm_web

<span class="gp">foo@bar:~$</span> docker-compose up -d
</pre></div>
</div>
</div>
<div class="section" id="visit-your-obm-app">
<h3>Visit your OBM app<a class="headerlink" href="#visit-your-obm-app" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://localhost:9880/">http://localhost:9880/</a></p>
<p><a class="reference external" href="http://localhost:9880/projects/sablon/">http://localhost:9880/projects/sablon/</a></p>
<p>Log in your template databse using <em>valaki&#64;openbiomaps.org</em> user name and <em>abc123</em> password;</p>
</div>
<div class="section" id="database-access">
<h3>Database access<a class="headerlink" href="#database-access" title="Permalink to this headline">¶</a></h3>
<p>You can access your postgres database on the following preconfigured online database manager applications:</p>
<p><a class="reference external" href="http://localhost:9881/">phppgadmin</a></p>
<p><a class="reference external" href="http://localhost:9882/">adminer</a></p>
<p>with <em>sablon_admin</em> username and <em>12345</em> password. You can manage your database with <em>biomapsadmin</em> user and <em>abcd1234</em> password.</p>
<p>If you change these passwords, should be updated the following places:</p>
<p>/etc/openbiomaps/system_vars.php.inc</p>
<p>/var/www/html/biomaps/projects/sablon/local_vars.php.inc</p>
<p>/var/www/html/biomaps/projects/sablon/private/private.map</p>
<p>In the mapfile, the new encrypted password can be generated with the ms-access-key located in /var/lib/openbiomaps/maps/access.key</p>
<p>The two databases ‘biomaps’ and ‘gisdata’ have root postgres users respectively <em>biomaps</em> and <em>gisdata</em> (instead of the ususal <em>postgres</em>) and both password is <em>changeMe</em>.</p>
</div>
<div class="section" id="obm-maintenance">
<h3>OBM maintenance<a class="headerlink" href="#obm-maintenance" title="Permalink to this headline">¶</a></h3>
<p>You can access OBM server admin interface:
<a class="reference external" href="http://localhost:9880/supervisor.php">http://localhost:9880/supervisor.php</a></p>
<p>with <em>supervisor</em> username and <em>12345</em> password. This password is located at /etc/openbiomaps/.htaccess.</p>
</div>
<div class="section" id="updates-update-application-with-docker">
<h3>Updates: update application with Docker<a class="headerlink" href="#updates-update-application-with-docker" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> git pull https://gitlab.com/openbiomaps/docker/obm-composer.git
<span class="gp">foo@bar:~$</span> docker-compose pull
<span class="go">Pulling gisdata    ... done</span>
<span class="go">Pulling biomaps    ... done</span>
<span class="go">Pulling mapserver  ... done</span>
<span class="go">Pulling app        ... done</span>
<span class="go">Pulling phppgadmin ... done</span>
<span class="go">Pulling adminer    ... done</span>

<span class="gp">foo@bar:~$</span> docker-compose up -d
<span class="go">Starting obm-composer_gisdata_1 ... done</span>
<span class="go">Starting obm-composer_biomaps_1 ... done</span>
<span class="go">Starting obm-composer_mapserver_1  ... done</span>
<span class="go">Starting obm-composer_adminer_1    ... done</span>
<span class="go">Starting obm-composer_phppgadmin_1 ... done</span>
<span class="go">Recreating obm-composer_app_1      ... done</span>
</pre></div>
</div>
</div>
<div class="section" id="stopping-docker">
<h3>Stopping docker<a class="headerlink" href="#stopping-docker" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose down
</pre></div>
</div>
</div>
<div class="section" id="drop-everything-including-data-and-databases">
<h3>Drop everything (including data and databases)<a class="headerlink" href="#drop-everything-including-data-and-databases" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose down -v
</pre></div>
</div>
</div>
<div class="section" id="shell-access-of-web-app">
<h3>Shell access of web app<a class="headerlink" href="#shell-access-of-web-app" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose <span class="nb">exec</span> app bash
</pre></div>
</div>
</div>
<div class="section" id="reading-logs">
<h3>Reading logs<a class="headerlink" href="#reading-logs" title="Permalink to this headline">¶</a></h3>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose logs -f app
</pre></div>
</div>
</div>
<div class="section" id="using-pgtop">
<h3>Using pgtop<a class="headerlink" href="#using-pgtop" title="Permalink to this headline">¶</a></h3>
<p>docker-compose exec -u postgres <span class="raw-html-m2r"><service_name></span> pg_top</p>
</div>
<div class="section" id="restart-app">
<h3>Restart app<a class="headerlink" href="#restart-app" title="Permalink to this headline">¶</a></h3>
<p>Do not restart apache from docker shell, but from outside</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">foo@bar:~$</span> docker-compose restart app
</pre></div>
</div>
</div>
<div class="section" id="set-up-mailing">
<h3>Set up mailing<a class="headerlink" href="#set-up-mailing" title="Permalink to this headline">¶</a></h3>
<p>Assuming that the new servers do not have their own domain name, the default value for sending mail is set to smtp (/etc/openbiomaps/system_vars.php.inc), which requires you to configure outgoing smtp servers and associated authentication for each projects (/var/www/html/biomaps/projects/…/local_vars.php.inc)</p>
<p>These config files as a template can be accessed from your “obm-composer” directory:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">ls -l obm-composer/econf/</span>
<span class="go">-rw-r--r-- 1 foo bar 2059 Feb  5 20:59 local_vars-sablon.php.inc</span>
<span class="go">-rw-r--r-- 1 foo bar  417 Feb  5 20:45 server_vars.php.inc</span>
<span class="go">-rw-r--r-- 1 foo bar  819 Feb  5 20:36 system_vars.php.inc</span>
</pre></div>
</div>
<p>To be able to apply a new setting here in the running system, you have to edit your Docker config file</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">vi obm-composer/docker-compose.yml</span>
<span class="go"> 20       # comment out to enable local config files</span>
<span class="go"> 21       # - ./econf/system_vars.php.inc:/etc/openbiomaps/system_vars.php.inc</span>
<span class="go"> 22       # - ./econf/server_vars.php.inc:/var/www/html/biomaps/server_vars.php.inc</span>
<span class="go"> 23       # - ./econf/local_vars-sablon.php.inc:/var/www/html/biomaps/projects/sablon/local_vars.php.inc</span>
</pre></div>
</div>
<p>As you can see, there are commented references for these external files which will be included “on the fly” in your running system.</p>
<p>So, you have to edit your obm-composer/econf/local_vars-sablon.php.inc file for the default “sablon” project.</p>
<p>Find the Mail Settings section</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">45 // Mail settings</span>
<span class="go">46 define(&#39;SMTP_AUTH&#39;,false); # true</span>
<span class="go">47 define(&#39;SMTP_HOST&#39;,&#39;...&#39;);</span>
<span class="go">48 define(&#39;SMTP_USERNAME&#39;,&#39;...&#39;);</span>
<span class="go">49 define(&#39;SMTP_PASSWORD&#39;,&#39;...&#39;);</span>
<span class="go">50 define(&#39;SMTP_SECURE&#39;,&#39;tls&#39;); # ssl</span>
<span class="go">51 define(&#39;SMTP_PORT&#39;,&#39;587&#39;); # 465</span>
<span class="go">52 define(&#39;SMTP_SENDER&#39;,&#39;openbiomaps@...&#39;);</span>
</pre></div>
</div>
<p>Set these variables as you need. E.g.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">45 // Mail settings</span>
<span class="go">46 define(&#39;SMTP_AUTH&#39;,false); # true</span>
<span class="go">47 define(&#39;SMTP_HOST&#39;,&#39;mail.my-mail-server.com&#39;);</span>
<span class="go">48 define(&#39;SMTP_USERNAME&#39;,&#39;my-name@my-mail-server.com&#39;);</span>
<span class="go">49 define(&#39;SMTP_PASSWORD&#39;,&#39;something&#39;);</span>
<span class="go">50 define(&#39;SMTP_SECURE&#39;,&#39;tls&#39;); # ssl</span>
<span class="go">51 define(&#39;SMTP_PORT&#39;,&#39;587&#39;); # 465</span>
<span class="go">52 define(&#39;SMTP_SENDER&#39;,&#39;openbiomaps@my-mail-server.com&#39;);</span>
</pre></div>
</div>
<p>If SMTP_SENDER is not set the SMTP_USERNAME will be the sender. Sending mails with google, with these simple settings is not possible, because google uses xoauth layer to authenticate! It is possible to include that layer here!</p>
</div>
<div class="section" id="docker-maintenance">
<h3>Docker maintenance<a class="headerlink" href="#docker-maintenance" title="Permalink to this headline">¶</a></h3>
<p>Remove huge amount of old, not used docker images…</p>
<p>Do we have a lot?</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker images | grep &quot;&lt;none&gt;&quot;</span>
</pre></div>
</div>
<p>Let drop them….</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker images | grep &quot;&lt;none&gt;&quot; | awk &#39;{print $3}&#39; | sed -e &#39;s/^/docker rmi /&#39; | bash</span>
</pre></div>
</div>
</div>
<div class="section" id="founding-a-new-project-in-docker">
<h3>Founding a new project in Docker<a class="headerlink" href="#founding-a-new-project-in-docker" title="Permalink to this headline">¶</a></h3>
<p>Some updates….</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker cp obm-composer_app_1:/var/www/html/biomaps/projects/YOUR_PROJECT/local_vars.php.inc ./econf/local_vars-YOUR_PROJECT.inc</span>
</pre></div>
</div>
<p>Include this econf path below the app volumes as like sablon example.</p>
</div>
<div class="section" id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://gitlab.com/openbiomaps/web-app">https://gitlab.com/openbiomaps/web-app</a></li>
<li><a class="reference external" href="https://gitlab.com/openbiomaps/docker">https://gitlab.com/openbiomaps/docker</a></li>
<li><a class="reference external" href="https://hub.docker.com/r/gaspara/obm-web-app">https://hub.docker.com/r/gaspara/obm-web-app</a></li>
</ul>
</div>
</div>
<div class="section" id="not-docker-virtualbox">
<h2>Not docker: VirtualBox<a class="headerlink" href="#not-docker-virtualbox" title="Permalink to this headline">¶</a></h2>
<p>The VirtualBox edition currently is outdated, not recommended to use it!</p>
<ol class="arabic simple">
<li>Download virtualbox from <a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
<li>Download the latest .ova image from <a class="reference external" href="http://openbiomaps.org/downloads/virtual-image/">http://openbiomaps.org/downloads</a></li>
<li>Read this readme for the the next steps: <a class="reference external" href="http://openbiomaps.org/downloads/virtual-image/README">http://openbiomaps.org/downloads/virtual-image/README</a></li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Virtual servers</a><ul>
<li><a class="reference internal" href="#docker">Docker</a><ul>
<li><a class="reference internal" href="#prepare-install-docker-compose">Prepare/Install Docker &amp; Compose</a></li>
<li><a class="reference internal" href="#obm-docker-install">OBM docker install</a></li>
<li><a class="reference internal" href="#visit-your-obm-app">Visit your OBM app</a></li>
<li><a class="reference internal" href="#database-access">Database access</a></li>
<li><a class="reference internal" href="#obm-maintenance">OBM maintenance</a></li>
<li><a class="reference internal" href="#updates-update-application-with-docker">Updates: update application with Docker</a></li>
<li><a class="reference internal" href="#stopping-docker">Stopping docker</a></li>
<li><a class="reference internal" href="#drop-everything-including-data-and-databases">Drop everything (including data and databases)</a></li>
<li><a class="reference internal" href="#shell-access-of-web-app">Shell access of web app</a></li>
<li><a class="reference internal" href="#reading-logs">Reading logs</a></li>
<li><a class="reference internal" href="#using-pgtop">Using pgtop</a></li>
<li><a class="reference internal" href="#restart-app">Restart app</a></li>
<li><a class="reference internal" href="#set-up-mailing">Set up mailing</a></li>
<li><a class="reference internal" href="#docker-maintenance">Docker maintenance</a></li>
<li><a class="reference internal" href="#founding-a-new-project-in-docker">Founding a new project in Docker</a></li>
<li><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#not-docker-virtualbox">Not docker: VirtualBox</a></li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index.html">openbiomaps 3.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright OpenBioMaps Consortium 2015 - 2020.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>